(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/test-login-cookie/test-login-cookie"],{2800:function(t,o,n){"use strict";n.r(o);var e=n("e5f0"),a=n("3af1");for(var r in a)"default"!==r&&function(t){n.d(o,t,function(){return a[t]})}(r);n("8298");var i,s=n("f0c5"),u=Object(s["a"])(a["default"],e["b"],e["c"],!1,null,"4aae358d",null,!1,e["a"],i);o["default"]=u.exports},"33fb":function(t,o,n){},"3af1":function(t,o,n){"use strict";n.r(o);var e=n("855f"),a=n.n(e);for(var r in e)"default"!==r&&function(t){n.d(o,t,function(){return e[t]})}(r);o["default"]=a.a},8298:function(t,o,n){"use strict";var e=n("33fb"),a=n.n(e);a.a},"855f":function(t,o,n){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e=n("2f62");function a(t,o){return s(t)||i(t,o)||r()}function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(t,o){var n=[],e=!0,a=!1,r=void 0;try{for(var i,s=t[Symbol.iterator]();!(e=(i=s.next()).done);e=!0)if(n.push(i.value),o&&n.length===o)break}catch(u){a=!0,r=u}finally{try{e||null==s["return"]||s["return"]()}finally{if(a)throw r}}return n}function s(t){if(Array.isArray(t))return t}function u(t){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{},e=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.forEach(function(o){c(t,o,n[o])})}return t}function c(t,o,n){return o in t?Object.defineProperty(t,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[o]=n,t}var d={data:function(){return{nickName:t.getStorageSync("nickName")||"游客",avatarUrl:t.getStorageSync("avatarUrl")||"../../static/avatar.png"}},computed:u({},(0,e.mapState)(["isLogin","todoCount","memoCount","restTodoCount"]),{online:function(){return this.isLogin?"在线中":"已下线"}}),methods:u({},(0,e.mapMutations)(["changeLoginStatus","assignMemoCount","assignTodoCount","assignRestTodoCount"]),{switchTab:function(o){var n={memo:"../memo/memo",todo:"../todo/todo"};t.switchTab({url:n[o]})},wxLogin:function(o){var n=this;if(this.isLogin)t.showToast({title:"您已登录"});else{if(!o.detail.iv)return t.showToast({title:"请授权登录",icon:"none"}),void this.changeLoginStatus(!1);var e=o.detail.userInfo,r=e.nickName,i=e.avatarUrl;t.login({provider:"weixin"}).then(function(o){var e=a(o,2),s=e[1].code;n.$http.post("/auth/wxlogin/".concat(s),{nickName:r,avatarUrl:i},{header:{Cookie:"userId=".concat(t.getStorageSync("userId"))}}).then(function(o){if(200===o.statusCode){if(0!==o.cookies.length){var e=o.cookies[0].split("="),s=a(e,2),u=s[1];t.setStorageSync("userId",u)}t.setStorageSync("memoCount",o.data.data.memoCount),t.setStorageSync("todoCount",o.data.data.todoCount),t.setStorageSync("restTodoCount",o.data.data.restTodoCount),n.assignMemoCount(o.data.data.memoCount),n.assignTodoCount(o.data.data.todoCount),n.assignRestTodoCount(o.data.data.restTodoCount),n.changeLoginStatus(!0),t.$emit("loginFinished"),n.nickName=r,n.avatarUrl=i,t.setStorageSync("nickName",r),t.setStorageSync("avatarUrl",i),t.showToast({title:"登录成功",icon:"success"})}else 500===o.statusCode&&(n.changeLoginStatus(!1),t.showToast({title:"登录失败, 后台出了一点问题",icon:"../../static/大哭.png"}))})})}}}),onPullDownRefresh:function(){var o=this;if(!this.isLogin)return t.showToast({title:"请先登录",image:"../../static/login.png"}),void t.stopPullDownRefresh();t.getUserInfo({provider:"weixin",withCredentials:!0,success:function(n){var e=n.userInfo,r=e.nickName,i=e.avatarUrl;o.nickName=r,o.avatarUrl=i,t.setStorageSync("nickName",r),t.setStorageSync("avatarUrl",i),t.login({provider:"weixin"}).then(function(n){var e=a(n,2);e[1].code;o.$http.post("/auth/updateUserInfo",{nickName:r,avatarUrl:i},{header:{Cookie:"userId=".concat(t.getStorageSync("userId"))}}).then(function(n){if(200===n.statusCode){t.stopPullDownRefresh();var e=n.data.data,a=e.memoCount,r=e.todoCount,i=e.restTodoCount;t.setStorageSync("memoCount",a),t.setStorageSync("todoCount",r),t.setStorageSync("restTodoCount",i),o.assignMemoCount(a),o.assignTodoCount(r),o.assignRestTodoCount(i)}else 500===n.statusCode&&t.showToast({title:"数据更新失败, 后台出了一点问题",icon:"../../static/大哭.png"})})})}})}};o.default=d}).call(this,n("543d")["default"])},9828:function(t,o,n){"use strict";(function(t){n("bd55"),n("921b");e(n("66fd"));var o=e(n("2800"));function e(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,n("543d")["createPage"])},e5f0:function(t,o,n){"use strict";var e,a=function(){var t=this,o=t.$createElement;t._self._c},r=[];n.d(o,"b",function(){return a}),n.d(o,"c",function(){return r}),n.d(o,"a",function(){return e})}},[["9828","common/runtime","common/vendor"]]]);